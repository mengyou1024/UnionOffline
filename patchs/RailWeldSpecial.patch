From d0eefef550b15369dcabe02339e6517186611fb1 Mon Sep 17 00:00:00 2001
From: mengyou <1523038073@qq.com>
Date: Tue, 4 Jun 2024 15:54:28 +0800
Subject: [PATCH] patchs: railweld specializatioon

---
 CMakeLists.txt                    | 2 +-
 cmake/FindMorose.cmake            | 5 ++++-
 morose_config.h.in                | 4 ++--
 resource/qml/About.qml            | 2 +-
 resource/qml/main.qml             | 3 ++-
 script/pack-installer-msvc.iss.in | 2 +-
 script/pack-installer.iss.in      | 2 +-
 translations/UnionOffline_en.ts   | 2 +-
 8 files changed, 13 insertions(+), 9 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c900b7e..a2dad89 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,6 +1,6 @@
 cmake_minimum_required(VERSION 3.20)
 
-project(UnionOffline LANGUAGES CXX)
+project(RailWeldOffline LANGUAGES CXX)
 
 set(CMAKE_CXX_STANDARD 20)
 set(NUMCPP_NO_USE_BOOST ON)
diff --git a/cmake/FindMorose.cmake b/cmake/FindMorose.cmake
index 999290e..9c7f1e1 100644
--- a/cmake/FindMorose.cmake
+++ b/cmake/FindMorose.cmake
@@ -319,6 +319,7 @@ function(morose_copy)
                     set(COPY_DIRNAME ${COPY_RENAME})
                 endif(COPY_DIR_LEN EQUAL "1")
             endif(COPY_RENAME)
+
             list(APPEND DEP_FILE_STRING "${CMAKE_CURRENT_SOURCE_DIR}/${ITEM}")
             list(APPEND COPY_DIR_STRING COMMAND ${CMAKE_COMMAND} -E copy_directory_if_different "${CMAKE_CURRENT_SOURCE_DIR}/${ITEM}" "${CMAKE_BINARY_DIR}${COPY_DIST_DIR}${COPY_DIRNAME}")
 
@@ -404,6 +405,7 @@ function(morose_add_environment_config_file)
     endif(CMAKE_BUILD_TYPE STREQUAL "Release")
 
     set(CONFIG_DEPS "")
+
     if(CMAKE_BUILD_TYPE STREQUAL "Release")
         set(CONFIG_DEPS "${CMAKE_SOURCE_DIR}/${CONF_PRODUCT}")
     else(CMAKE_BUILD_TYPE STREQUAL "Release")
@@ -463,7 +465,8 @@ add_custom_target(
     COMMAND powershell "Copy-Item -Force -Recurse ${CMAKE_SOURCE_DIR}/.git ${CMAKE_SOURCE_DIR}/output/archive/.git;\
     cd ${CMAKE_SOURCE_DIR}/output/archive/; \
     git reset --hard;\
-    git submodule update --init --recursive" > nul
+    git submodule update --init --recursive;\
+    git apply ./patchs/RailWeldSpecial.patch" > nul
     COMMAND echo "{\
 \"APP_VERSION\":\"${APP_VERSION}\",\
 \"APP_URL\": \"${APP_URL}\",\
diff --git a/morose_config.h.in b/morose_config.h.in
index f724039..5bb7228 100644
--- a/morose_config.h.in
+++ b/morose_config.h.in
@@ -2,5 +2,5 @@
 
 #define APP_VERSION                    "@APP_VERSION@"
 
-#define ENABLE_UNION_GENERIC           (1) ///< 使用通用仪器接口
-#define ENABLE_RAILWELE_SPECIALIZATION (0) ///< 使用钢轨焊缝特化接口
+#define ENABLE_UNION_GENERIC           (0) ///< 使用通用仪器接口
+#define ENABLE_RAILWELE_SPECIALIZATION (1) ///< 使用钢轨焊缝特化接口
diff --git a/resource/qml/About.qml b/resource/qml/About.qml
index c1b8bdb..300c29b 100644
--- a/resource/qml/About.qml
+++ b/resource/qml/About.qml
@@ -40,7 +40,7 @@ ApplicationWindow {
                 Layout.fillWidth: true
                 verticalAlignment: Qt.AlignVCenter
                 font.pixelSize: 18
-                text: `通用离线分析软件 ${MOROSE_APP_VERSION}`
+                text: `钢轨焊缝离线分析软件 ${MOROSE_APP_VERSION}`
             }
             Text {
                 Layout.fillWidth: true
diff --git a/resource/qml/main.qml b/resource/qml/main.qml
index 6eca0c4..9ef3133 100644
--- a/resource/qml/main.qml
+++ b/resource/qml/main.qml
@@ -18,7 +18,7 @@ ApplicationWindow {
     minimumHeight: 870
     visible: true
     id: wnd_main
-    title: qsTr("通用离线分析软件")
+    title: qsTr("钢轨焊缝离线分析软件")
 
     property string mainUIType: "Unknow"
 
@@ -70,6 +70,7 @@ ApplicationWindow {
                     img_src: "qrc:/img/USB_51.png"
                     btn_txt: qsTr("通讯")
                     height: parent.height
+                    visible: false
                     onClicked: {
                         var comp = Qt.createComponent("Communicate.qml")
                         if (comp.status === Component.Ready) {
diff --git a/script/pack-installer-msvc.iss.in b/script/pack-installer-msvc.iss.in
index 560f60d..dd8a63d 100644
--- a/script/pack-installer-msvc.iss.in
+++ b/script/pack-installer-msvc.iss.in
@@ -13,7 +13,7 @@
 [Setup]
 ; 注意:AppId的值唯一标识该应用程序。不要在其他应用程序的安装程序中使用相同的AppId值。
 ; (要生成新的GUID，请在IDE中单击Tools | generate GUID。)
-AppId={{65C66E39-C539-4D2D-9DEF-664965A9C599}
+AppId={{E966BD6F-B7A2-41DD-A96F-FE4DAD7F994E}
 AppName={#MyAppName}
 AppVersion={#MyAppVersion}
 ;AppVerName={#MyAppName} {#MyAppVersion}
diff --git a/script/pack-installer.iss.in b/script/pack-installer.iss.in
index 769681a..080f63f 100644
--- a/script/pack-installer.iss.in
+++ b/script/pack-installer.iss.in
@@ -13,7 +13,7 @@
 [Setup]
 ; 注意:AppId的值唯一标识该应用程序。不要在其他应用程序的安装程序中使用相同的AppId值。
 ; (要生成新的GUID，请在IDE中单击Tools | generate GUID。)
-AppId={{65C66E39-C539-4D2D-9DEF-664965A9C599}
+AppId={{E966BD6F-B7A2-41DD-A96F-FE4DAD7F994E}
 AppName={#MyAppName}
 AppVersion={#MyAppVersion}
 ;AppVerName={#MyAppName} {#MyAppVersion}
diff --git a/translations/UnionOffline_en.ts b/translations/UnionOffline_en.ts
index 209f3ee..331a2cb 100644
--- a/translations/UnionOffline_en.ts
+++ b/translations/UnionOffline_en.ts
@@ -521,7 +521,7 @@
     <name>main</name>
     <message>
         <location filename="../resource/qml/main.qml" line="20"/>
-        <source>通用离线分析软件</source>
+        <source>钢轨焊缝离线分析软件</source>
         <translation type="unfinished"></translation>
     </message>
     <message>
-- 
2.43.0.windows.1

