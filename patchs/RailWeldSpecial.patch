From bccbddbbd58c5cb2676bdd60b1f7dd909318e782 Mon Sep 17 00:00:00 2001
From: mengyou <1523038073@qq.com>
Date: Tue, 14 May 2024 11:47:09 +0800
Subject: [PATCH] chore: init patchs RailWeldSpecial

---
 CMakeLists.txt                    |  2 +-
 cmake/FindMorose.cmake            |  1 +
 resource/qml/About.qml            |  2 +-
 resource/qml/main.qml             | 26 +-------------------------
 script/pack-installer-msvc.iss.in |  2 +-
 script/pack-installer.iss.in      |  2 +-
 src/common/common.cpp             | 11 -----------
 translations/UnionOffline_en.ts   |  2 +-
 8 files changed, 7 insertions(+), 41 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4199914..b82b649 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,6 +1,6 @@
 cmake_minimum_required(VERSION 3.20)
 
-project(UnionOffline LANGUAGES CXX)
+project(RailWeldOffline LANGUAGES CXX)
 
 set(CMAKE_CXX_STANDARD 20)
 set(NUMCPP_NO_USE_BOOST ON)
diff --git a/cmake/FindMorose.cmake b/cmake/FindMorose.cmake
index 9eac144..0dfc8fe 100644
--- a/cmake/FindMorose.cmake
+++ b/cmake/FindMorose.cmake
@@ -22,6 +22,7 @@ macro(morose_main_setup)
                     "the git describe is use for varible `APP_VERSION`"
                 )
             else()
+                string(REGEX MATCH "v[^-]+" APP_VERSION ${APP_VERSION})
                 message(STATUS "APP VERSION:" ${APP_VERSION})
             endif()
 
diff --git a/resource/qml/About.qml b/resource/qml/About.qml
index c1b8bdb..300c29b 100644
--- a/resource/qml/About.qml
+++ b/resource/qml/About.qml
@@ -40,7 +40,7 @@ ApplicationWindow {
                 Layout.fillWidth: true
                 verticalAlignment: Qt.AlignVCenter
                 font.pixelSize: 18
-                text: `通用离线分析软件 ${MOROSE_APP_VERSION}`
+                text: `钢轨焊缝离线分析软件 ${MOROSE_APP_VERSION}`
             }
             Text {
                 Layout.fillWidth: true
diff --git a/resource/qml/main.qml b/resource/qml/main.qml
index f68f426..3202179 100644
--- a/resource/qml/main.qml
+++ b/resource/qml/main.qml
@@ -18,7 +18,7 @@ ApplicationWindow {
     minimumHeight: 870
     visible: true
     id: wnd_main
-    title: qsTr("通用离线分析软件")
+    title: qsTr("钢轨焊缝离线分析软件")
 
     property string mainUIType: "Unknow"
 
@@ -62,30 +62,6 @@ ApplicationWindow {
                     onClicked: btnParamClicked()
                 }
 
-                CIconButton {
-                    implicitWidth: 80
-                    img_src: "qrc:/img/USB_51.png"
-                    btn_txt: qsTr("通讯")
-                    height: parent.height
-                    onClicked: {
-                        var comp = Qt.createComponent("Communicate.qml")
-                        if (comp.status === Component.Ready) {
-                            var com_wnd = comp.createObject(parent)
-                            com_wnd.closing.connect(() => {
-                                                        comp.destroy()
-                                                        com_wnd.destroy()
-                                                    })
-                            com_wnd.saveTemporaryFile.connect(filePath => {
-                                                                  console.log(category, "on saveTemporaryFile trigger file:", filePath)
-                                                                  actionMainType(getMainUITypeIndex(filePath), filePath)
-                                                                  listView.currentIndex = -1
-                                                              })
-                        } else if (comp.status === Component.Error) {
-                            console.error(category, comp.errorString())
-                        }
-                    }
-                }
-
                 CIconButton {
                     img_src: "qrc:/img/config-language.ico"
                     btn_txt: qsTr("帮助")
diff --git a/script/pack-installer-msvc.iss.in b/script/pack-installer-msvc.iss.in
index 560f60d..dd8a63d 100644
--- a/script/pack-installer-msvc.iss.in
+++ b/script/pack-installer-msvc.iss.in
@@ -13,7 +13,7 @@
 [Setup]
 ; 注意:AppId的值唯一标识该应用程序。不要在其他应用程序的安装程序中使用相同的AppId值。
 ; (要生成新的GUID，请在IDE中单击Tools | generate GUID。)
-AppId={{65C66E39-C539-4D2D-9DEF-664965A9C599}
+AppId={{E966BD6F-B7A2-41DD-A96F-FE4DAD7F994E}
 AppName={#MyAppName}
 AppVersion={#MyAppVersion}
 ;AppVerName={#MyAppName} {#MyAppVersion}
diff --git a/script/pack-installer.iss.in b/script/pack-installer.iss.in
index 769681a..080f63f 100644
--- a/script/pack-installer.iss.in
+++ b/script/pack-installer.iss.in
@@ -13,7 +13,7 @@
 [Setup]
 ; 注意:AppId的值唯一标识该应用程序。不要在其他应用程序的安装程序中使用相同的AppId值。
 ; (要生成新的GUID，请在IDE中单击Tools | generate GUID。)
-AppId={{65C66E39-C539-4D2D-9DEF-664965A9C599}
+AppId={{E966BD6F-B7A2-41DD-A96F-FE4DAD7F994E}
 AppName={#MyAppName}
 AppVersion={#MyAppVersion}
 ;AppVerName={#MyAppName} {#MyAppVersion}
diff --git a/src/common/common.cpp b/src/common/common.cpp
index 81dbd33..e4194cb 100644
--- a/src/common/common.cpp
+++ b/src/common/common.cpp
@@ -141,13 +141,8 @@ void Morose::registerVariable(QQmlContext* context) {
 }
 
 void Morose::registeAllAScanFileSelector() {
-    Union::AScan::AScanFileSelector::Instance().RegistReader("*.ldat", "390N、T8连续图像", Union::__390N_T8::LDAT::FromFile);
-    Union::AScan::AScanFileSelector::Instance().RegistReader("*.vdata", "390N、T8带摄像头图像", Union::__390N_T8::VDATA::FromFile);
-    Union::AScan::AScanFileSelector::Instance().RegistReader("*.json", "390N、T8单幅图像", Union::__390N_T8::T8_390N_JSON::FromFile);
-    Union::AScan::AScanFileSelector::Instance().RegistReader("*.das", "330单幅图像", Union::__330::DASType::FromFile);
     Union::AScan::AScanFileSelector::Instance().RegistReader("*.daa", "390钢轨焊缝单幅图像", Union::__390::DAAType::FromFile);
     Union::AScan::AScanFileSelector::Instance().RegistReader("*.DAT", "330连续图像", Union::__330::DATType::FromFile);
-    Union::AScan::AScanFileSelector::Instance().RegistReader("*.cod", "330串口数据", Union::__330::Serial_330::FromFile);
 }
 
 QJsonObject& Morose::getGlobalEnvironment() {
@@ -185,12 +180,6 @@ void Morose::registNameFilter(QQmlContext* context) {
     folderListModel_nameFilter += Union::AScan::AScanFileSelector::Instance().GetFileListModelNameFilter().toVariantList();
     filedialog_nameFilter += Union::AScan::AScanFileSelector::Instance().GetFileNameFilter().toVariantList();
 
-    // TOFD_PE
-    Union::TOFD_PE::TofdPeFileSelector::Instance().RegistReader("*.tpe", "TOFD/PE图像", Union::TOFD_PE::TPE::TpeType::FromFile);
-    mainUi_map.insert(Union::TOFD_PE::TofdPeFileSelector::Instance().GetUINameMap().toVariantMap());
-    folderListModel_nameFilter += Union::TOFD_PE::TofdPeFileSelector::Instance().GetFileListModelNameFilter().toVariantList();
-    filedialog_nameFilter += Union::TOFD_PE::TofdPeFileSelector::Instance().GetFileNameFilter().toVariantList();
-
     context->setContextProperty("FOLDERLISTMODEL_NAMEFILTER", folderListModel_nameFilter);
     context->setContextProperty("FILEDIALOG_NAMEFILTER", filedialog_nameFilter);
     context->setContextProperty("MAINUI_MAP", mainUi_map);
diff --git a/translations/UnionOffline_en.ts b/translations/UnionOffline_en.ts
index 209f3ee..331a2cb 100644
--- a/translations/UnionOffline_en.ts
+++ b/translations/UnionOffline_en.ts
@@ -521,7 +521,7 @@
     <name>main</name>
     <message>
         <location filename="../resource/qml/main.qml" line="20"/>
-        <source>通用离线分析软件</source>
+        <source>钢轨焊缝离线分析软件</source>
         <translation type="unfinished"></translation>
     </message>
     <message>
-- 
2.43.0.windows.1

